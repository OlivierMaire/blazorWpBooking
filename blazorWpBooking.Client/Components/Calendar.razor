@using System.Globalization

<div class="calendar">
	<div class="calendar-header">
		<button class="nav" @onclick="PrevMonth">&lt;</button>
		<div class="month">@_displayDate.ToString("MMMM yyyy")</div>
		<button class="nav" @onclick="NextMonth">&gt;</button>
	</div>

	<div class="calendar-grid">
		@foreach (var dayName in _dayNames)
		{
			<div class="calendar-dayname">@dayName</div>
		}

		@foreach (var cell in _calendarCells)
		{
			var css = "calendar-cell" + (cell.IsCurrentMonth ? "" : " other-month") + (cell.IsToday ? " today" : "");
			<div class="@css">@cell.Day</div>
		}
	</div>
</div>

@code {
	private DateTime _displayDate = DateTime.Today;
	private readonly string[] _dayNames = CultureInfo.CurrentCulture.DateTimeFormat.AbbreviatedDayNames;

	private List<CalendarCell> _calendarCells = new();

	protected override void OnInitialized()
	{
		BuildCalendar();
	}

	private void PrevMonth()
	{
		_displayDate = _displayDate.AddMonths(-1);
		BuildCalendar();
	}

	private void NextMonth()
	{
		_displayDate = _displayDate.AddMonths(1);
		BuildCalendar();
	}

	private void BuildCalendar()
	{
		_calendarCells.Clear();

		var firstOfMonth = new DateTime(_displayDate.Year, _displayDate.Month, 1);
		// Start from the first day of week that contains the first of month
		var firstDayOfWeek = CultureInfo.CurrentCulture.DateTimeFormat.FirstDayOfWeek;
		var diff = (7 + (firstOfMonth.DayOfWeek - firstDayOfWeek)) % 7;
		var startDate = firstOfMonth.AddDays(-diff);

		for (int i = 0; i < 42; i++) // 6 weeks grid
		{
			var d = startDate.AddDays(i);
			_calendarCells.Add(new CalendarCell
			{
				Date = d,
				Day = d.Day,
				IsCurrentMonth = d.Month == _displayDate.Month,
				IsToday = d.Date == DateTime.Today
			});
		}
	}

	private record CalendarCell
	{
		public DateTime Date { get; init; }
		public int Day { get; init; }
		public bool IsCurrentMonth { get; init; }
		public bool IsToday { get; init; }
	}
}

<!-- Styles moved to Calendar.razor.scss -->

